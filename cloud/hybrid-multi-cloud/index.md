---
description: エレベータアーキテクトはアーキテクチャ上の決定とオプションを抽出するためにバズワードの先を思い描きます。今回はハイブリッドマルチクラウドについて考えてみましょう。
---

# ハイブリッドマルチクラウド: あるエレベーターアーキテクトの見解
          
エレベータアーキテクトはアーキテクチャ上の決定とオプションを抽出するためにバズワードの先を思い描きます。今回はハイブリッドマルチクラウドについて考えてみましょう。

## 輝くものを追いかける


寿命ある私たちは、既存のアプリケーションをクラウドに移行したり、新しいクラウドレディなアプリケーションを開発したりするのに忙しい日々を送り続けているにもかかわらず、マーケティング部門は一睡もせずに運転し、*マルチハイブリッドクラウドコンピューティング*(あるいはハイブリッドマルチというべきでしょうか?)のようなものを売り込みます。

永遠に輝き続けるものを追いかけることは、シンプルだけど動作するものを提供するより簡単だと、皮肉屋はすぐに断言してしまいます。新しいバズワードの燃えるような輝きに不意打ちを食らうことを避け、騒がしいざわめき(buzz)をアーキテクチャの洞察に翻訳するためにハイプを通り抜けましょう。
[マルチクラウドとハイブリッドクラウドに関する詳細な記事](https://www.cloudtp.com/doppler/hybrid-cloud-vs-multi-cloud-whats-difference-matter)と[Googleの友人達の書いたパターン](https://cloud.google.com/solutions/hybrid-and-multi-cloud-architecture-patterns)は役に立つのですが、私たちの持っている、そして決定する必要のある選択肢のアーキテクチャの本質について明確に説明していません。

ここで[アーキテクトエレベータに乗る](https://architectelevator.com/workshops)</a>アーキテクトの考え方が役に立ちます: 主要な決定事項、制約、仮定が解決方法に含まれているか? どのような[選択肢](https://architectelevator.com/architecture/architecture-options/)があり、どのような決定が必要か? それぞれの選択肢の利点やコスト、金額だけでなく複雑さやロックインは何か? では考えてみましょう!

## ハイブリッドは現実、マルチクラウドはオプション

最初に、ハイブリッドとマルチの違いについて見てみましょう。簡単なように見えますが、すでに混乱したり、定義の矛盾に気がついた人もいるでしょう。まずはシンプルに考えてみましょう:

- **ハイブリッド**: ワークロードをクラウドとオンプレに分割します。一般的にこれらのワークロードは一つのアプリケーションです。つまり、クラウド上のワークロードとオンプレ上のワークロードは何かを行うために協調して動作します。
- **マルチ**: 複数のクラウドプロバイダー上でワークロードを稼働させます。より正確な定義を求めるなら、意見は分かれています。

![Hybrid and multi](https://architectelevator.com/assets/img/hybrid_multi.png)

[GCP](https://cloud.google.com/solutions/hybrid-and-multi-cloud-patterns-and-practices)のようにオンプレをマルチクラウドの一部だと考える人たちもいます(「*マルチクラウドのセットアップにはプライベートコンピューティング環境も含まれます*」)。この二つは確かに技術的に関連していますが(「オンプレは単にもう一つのデータセンターにすぎません」)、ハイブリッドをマルチクラウドの一種と考えるのであれば、*マルチハイブリッド*という用語を使う必要はないでしょう。混乱してきましたか? では、別の観点で考えてみましょう。

> ある朝CIOが起きると、全てのワークロードがクラウド上で動いていることはありえません。ハイブリッドクラウドは現実的な話です。」

どのような技術であれ、ハイブリッドとマルチクラウド導入の目的と推進力は全く異なります。ハイブリッドクラウドは企業にとって現実です。[AWS Snowmobile](https://aws.amazon.com/snowmobile/)のようなクールな技術があるにも関わらず、ある朝CIOが起きると、全てのワークロードがクラウド上で動いていることはありえません。いくつかは「外」に、いくつかは「内」に残り続けます。そして多分、外と内はつながっている必要があるでしょう。

> ハイブリッドクラウド戦略の中核は「どのように分割するか」です。つまり、どのワークロードを外に置くべきか、何がオンプレに残り続けるかです。この議論に関しては別の記事で取り上げます。

一方、マルチクラウド戦略はアーキテクチャの選択です。一般的なマルチクラウドアプローチとその背後の動機を調べることにより、アーキテクチャの選択が可能になります。

## マルチクラウドの分析

マルチクラウドを使う動機を理解するために、技術的なプラットフォームアーキテクチャを一般的なシナリオに分割してみましょう。「マルチクラウド」のスローガンのもとにパッケージ化されたものは、以下のカテゴリに分類できます。

![Multi-cloud architecture styles](https://architectelevator.com/assets/img/multi_options.png)

この比較において、大きな番号の方が良いというわけではありません。ニーズに一致するアプローチを見つけ、適切な選択をおこなうためのものです。

> マルチクラウドは白か黒の選択でもないし、全ての用途に適したアーキテクチャでもありません」</p>

### 気まぐれ(Arbitrary)

![Arbitrary multi-cloud](https://architectelevator.com/assets/img/multi_arbitrary.png)

企業が私たちに一つ教えてくれることがあるとすると、現実はプレゼンテーションスライドと一緒ではないという事です。この論法(そして皮肉の常用)をマルチクラウドに当てはめると、企業のマルチクラウドの多くはガバナンスの不在と行き過ぎたベンダーの影響力の結果であることがわかります。つまり、いくつかのワークロードはブルークラウドで、また別のワークロードはライトブルークラウド、そしてレインボークラウドで動いているものも二、三あるという状況です。どうしてこんな事になるのでしょうか。最初はオレンジクラウドで始めました。次に、既存のライセンスアグリーメントのおかげでライトブルークラウドから大幅な割引をしてもらいました。クールキッズ達はレインボウクラウドが大好きです。そして、注意深く観察してみると、個人的な関係とセールスの強烈な売り込みによってレッドクラウドも見えて来るかもしれません。

このマルチクラウドのセットアップに*戦略*という言葉はふさわしくありません。しかし、最悪というわけではありません。少なくとも*何か*をクラウドにデプロイしています。これは良い事です。なぜなら、[舵を取る前に動く必要がある](https://www.linkedin.com/pulse/before-you-can-steer-first-have-move-gregor-hohpe/)からです。少なくとも、動き始めています。つまり、複数の技術プラットフォームの経験と構築のスキルセットを手に入れようとしているという事です。[思考のアウトソース化](https://architectelevator.com/strategy/dont-outsource-thinking/)をしていなければですが。

### 分割(Segmented)

![Segmented multi-cloud](https://architectelevator.com/assets/img/multi_segmented.png)

ワークロードを異なるクラウドへ分割するのは一般的で、良い一歩です。特定の種類のワークロードを特定のクラウドにデプロイします。

このシナリオは、しばしば、異なる種類のワークロードに対するベンダーの好みから発生します。例えば、個々のベンダーの強みやライセンス条件などなどです。一般的な組み合わせの一つは、ほとんどのワークロードはオレンジで、Windows関連のワークロードはライトブルーで、機械学習/分析はレインボーで稼働させることです。これは、以下のカテゴリーにおけるベンダーの提供機能が激しく進化していたとしてもです。

いくつかの要因によって分割を決定することができます。

- ワークロードの種類 (レガシー、あるいはモダン)
- データの種類 (機密、オープン)
- 製品の種類 (計算、データ分析、コラボレーションソフトウェア)

このアプローチを採用する場合、アプリケーションの半分が左に残りが右になるため、莫大な外向きの通信費用がかからないように、アプリケーションの*つなぎ目*を理解すると良いでしょう。

また、私はベンダーとの関係によって、企業が*分割*から*気まぐれ*に戻っていくのを見たことがあります。クラウドベンダーXの特定の種類のサービスを使おうとしているとします。しかし、ベンダーの(プリ)セールスが、彼らの別のサービスを使うようにチームを説得するのです。それが彼らの仕事です。あなたは、どちらを使うか決める必要があります。そうしないと、95%の計算をシンガポールのECSで実行し、残りを東京のAppEngineで計算する羽目になります(実例です)。これは、ほとんど無意味です。

### 選択(Choice)

![Free choice multi-cloud](https://architectelevator.com/assets/img/multi_choice.png)

多くの人は、上の二つの例を*本物の*マルチクラウドとは考えないかもしれません。彼らが求めている(そして売り込んでいる)のは、ワークロードを自由に色々なクラウドプロバイダーにデプロイできるものです。そうすれば、ロックイン(あるいはそう認識しているもの)を最低限にすることができます。通常、これは抽象化レイヤー、あるいはガバナンスフレームワークを構築する事により実現します。

このような選択の自由は大規模な組織の共有ITプロバイダーにとって一般的です。彼らは幅広いビジネスユニットとITの好みをサポートすることを期待されています。多くの場合、このようなセットアップには、取引関係の一括管理と選択したクラウドプロバイダー上にインスタンスを作る共通のフレームワークが含まれています。そして、そのフレームワークにはコーポレートガバナンスと制約が組み込まれています。

このセットアップの利点は、プロジェクトがマネージドデータベースのようなプロプライエタリなクラウドサービスを自由に使えることです。ロックインを避けることと、オペレーションのオーバヘッドを最低限に抑えることのトレードオフの好み次第ではありますが。したがって、マルチクラウドの最初の一歩としてこのセットアップを目指す事には問題ありません。

### 並列(Parallel)

![Parallel multi-cloud](https://architectelevator.com/assets/img/multi_parallel.png)

前の選択肢はクラウドサービスプロバイダーの選択を可能にしますが、そのプロバイダーのサービスレベルに制約されます。多くの企業は、一つのプロバイダー、そして一つのプロバイダーの複数のアベイラビリティゾーンより高いレベルの可用性を保障するために、複数のクラウドにクリティカルなアプリケショーンをデプロイしようとしています。

同一のアプリケーションを複数のクラウドにでデプロイするためには、クラウドプロバイダーのプロプライエタリな機能のでカップリングが必要です。これには幾つかの方法があります。例えば、

- アイデンティティ管理、デプロイメントの自動化、モニタリングなどをアプリケーションから分離し、クラウドベンダー固有の方法で管理する
- 可能な限りオープンソースのコンポーネントを利用する。一般的にオープンソースのコンポーネントはどのクラウドでも実行可能です。これは純粋な計算(ほとんどのクラウドでマネージドKubernetesが提供されています)では比較的うまくいきますが、データストアやモニタリングのような完全なマネージドサービスを利用する利点が減るかもしれません。マネージドサービスはクラウドに移行する利点の一つなので、選択肢を慎重に検討する必要があります。
- マルチクラウドに対応した抽象化フレームワークを利用する。一度開発すれば、どのクラウドにもデプロイできます。
- アプリケーションにおけるクラウドプロバイダー固有のコンポーネントを二つのブランチで保守し、それらを共通のインターフェースでラップします。例えば、ブロックデータストレージの共通インターフェースを作ることができるでしょう。

最後の方法は、その場しのぎのように聞こえますが、データベースや他の多くの依存コンポーネントに対して行ってきたことと同じです。適切にラップされていれば、可能な選択肢です。

注意すべき重要な側面は複雑さです。複雑さのせいで期待していたほど稼働時間が増えないかもしれません。抽象化レイヤーやツールの追加により設定ミスの可能性も高まります。また、壊れたアプリケーションを両方のクラウドにデプロイしてしまうと、ダウンタイムが発生するので、ヒューマンエラーの考慮も必要です。私は、各ベンダーの三つのアベイラビリティゾーンにデプロイし、かつそれぞれにディスアスタリカバリーの環境を足した設計を提案するベンダーを見たことがあります。つまり、それぞれのコンポーネントは 3 * 2 * 3 = *18ノード*を必要とします。私は、この台数のマシンが9ノード(ゾーンごと、かつクラウドプロバイダーごとに1つ)より高い可用性を提供するかどうか疑っています。

## 移植(Portable)

![Portable multi-cloud](https://architectelevator.com/assets/img/multi_portable.png)

マルチクラウドの頂点と考えられているのは、クラウドをまたがる自由な移植性です。つまり、ワークロードをどこにでもデプロイでき、好きな所に移動できることです。利点は明白です。ベンダーロックインを避けることができます。これにより、例えばベンダーに対する交渉力を手に入れることができます。リソースのニーズに基づきアプリケーションを移動することができます。例えば、普段は一つのクラウド上で処理を実行し、バーストした過度なトラフィックを他のクラウドで実行することができます。

これを可能にする仕組みはクラウドサービスから分離された高度な自動化と抽象化です。並列(Parallel)デプロイメントの場合、半手動のセットアップやデプロイメントプロセスで十分かもしれません。しかし、完全な移植性のためにはワークロードをいつでも変更することができないといけないため、全てを完全に自動化する必要があります。

Anthosのようなマルチクラウド抽象化フレームワークはこのようなセットアップを簡単にします。しかし、無料というわけではありません。特定のベンダー、製品、アーキテクチャへのロックイン、それに加えてアプリケーションのコンテナへのデプロイという要件という形でコストがかかります。また、このような抽象化は一般的にデータを面倒みてくれません。計算ノードをプロバイダ間で自由に移動する場合、どのようにデータを同期しますか? もし、このハードルを超えたとしても、外向きのデータのコストが問題となる可能性も残っています。

## Polishing your shiny object

光り輝くものを追いかける時には、輝いているほど良いという思考の罠に陥りがちです。エンタープライズの戦いの傷を持っている人はみんな、輝くものを磨き、より輝きを増すためにはコストがかかることを良く知っています。お金のコストは明白な懸念事項ですが、さらなる複雑さも考慮する必要があります。複数のベンダーの管理、正しいスキルセットの発見、長期的な可能性(全てのコンテナを捨てて、サーバレスに移行しますか?)。これらの要因はお金では解決できません。

したがって、最も大事な目的を理解し、明確に伝えることが重要です。可用性の向上や、あるプロバイダーだけがデータセンターを持つリージョンへのデプロイのサポートをベンダーと交渉するために、あなたはマルチクラウドを検討していますか? ロックインの排除」は単にメタゴールにすぎません。望ましいアーキテクチャではありますが、具体的なメリットによって正当性を判断する必要があります。

次の表に、選択肢の概要、主要な推進力、注意すべき副作用をまとめます。

|スタイル|主要な機能|主要なメカニズム|考慮事項|
|--------|----------|----------------|--------|
|**気まぐれ(Arbitrary)**|アプリケーションをクラウドにデプロイ|クラウドのスキル|ガバナンスの欠如|
|**分割(Segmented)**|クラウドの利用方法の明確なガイダンス|ガバナンス|ベンダーに舵取りされ気まぐれ(Arbitrary)へ後戻り|
|**選択(Choice)**|プロジェクトのニーズと好みのサポート。ロックインの減少|プロビジョニング、支払い、ガバナンスのための共通フレームワーク|別のレイヤの抽象化。ガイダンスの欠如|
|**並行(Parallel)**|単一のクラウドより高い可用性|自動化と抽象化|複雑さ。クラウドサービス利用の減少|
|**移行可能(Portable)**|好きなところへのワークロードの移動|完全な自動化、抽象化|複雑さ。マルチクラウドフレームワークへのロックイン|

<p>予想通りTANSTAAFL、つまり*無料のランチはありません*(there ain’t no such a thing as a free lunch)。アーキテクチャはトレードオフの問題です。したがって、選択肢を分類し、意味のある名前をつけ、その意味を理解することが重要です。これらのツールを使えば、アーキテクトエレベータに乗り、ハイブリッドマルチクラウドの啓蒙の計画を立てることができます。
